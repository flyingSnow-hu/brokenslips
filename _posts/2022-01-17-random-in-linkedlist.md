---
layout: article
title: éšæœºé€‰å–é“¾è¡¨å…ƒç´ 
tags: algorithms random linkedlist
date: 2022-01-17
category: internal-strength
---
#éšæœºé€‰å–é“¾è¡¨å…ƒç´ 

**é—®é¢˜1ï¼š** æœ‰ä¸€ä¸ªé•¿åº¦æœªçŸ¥ä½†æœ‰é™çš„é“¾è¡¨K={k1, k2, k3...}ï¼Œç°åœ¨éœ€è¦ä»é“¾è¡¨ä¸­é€‰å–ä¸€ä¸ªå…ƒç´ ï¼Œä½¿å¾— K ä¸­æ¯ä¸€ä¸ªå…ƒç´ è¢«é€‰ä¸­çš„æ¦‚ç‡éƒ½ç›¸ç­‰ã€‚  
**è§£å†³1ï¼š** ä»å‰åˆ°åéå†é“¾è¡¨ã€‚è®¾å½“å‰å…ƒç´ ä¸º knï¼Œåˆ™ä»[0,n-1] ä¸­éšæœºä¸€ä¸ªæ•´æ•° rï¼Œå¦‚æœ r==0 åˆ™ä»¤ kn ä¸ºé€‰ä¸­å€¼ã€‚ç­‰é“¾è¡¨éå†è¿‡ä¸€æ¬¡ä¹‹åï¼Œå°†é€‰ä¸­å€¼è¿”å›ã€‚**æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚**  

```python
ret = k.first
crnt_node = k.first
count = 1
while crnt_node.next != None:
    # è¿™é‡ŒæŠŠæ•´æ•°å˜æˆäº†ç­‰ä»·çš„è¿ç»­åŒºé—´æ¦‚ç‡
    if rand() < 1 / count:
        ret = crnt_node
    crnt_node = crnt_node.next
    count++
```

> ğŸ’¡è€ƒè™‘ç¬¬ä¸€ä¸ªèŠ‚ç‚¹è¢«é€‰ä¸­çš„æ¦‚ç‡ p1ï¼š  
> å½“ n = 1 æ—¶ï¼Œæ¦‚ç‡æ˜¯ 1ï¼›  
> å½“ n = 2 æ—¶ï¼Œæ¦‚ç‡æ˜¯ 1/2ï¼›  
> å½“ n = 3 æ—¶ï¼Œæ¦‚ç‡æ˜¯åœ¨ n=2 é€‰ä¸­çš„åŸºç¡€ä¸Šä¹˜ä»¥ 2/3ï¼Œå› æ­¤æ˜¯ 1/2 Ã— 2/3ï¼›  
> ç»§ç»­æ¨ç®— n=4 æ—¶æ¦‚ç‡æ˜¯ 1/2 Ã— 2/3 Ã— 3/4ï¼›  
> ...  
> å‡è®¾é“¾è¡¨é•¿åº¦ä¸ºLï¼Œn = L æ—¶æ¦‚ç‡æ˜¯ p1 = 1/2 Ã— 2/3 Ã— 3/4 Ã— ... Ã— (L-1)/L = 1/L  
> è€ƒè™‘ç¬¬ k ä¸ªèŠ‚ç‚¹è¢«é€‰ä¸­çš„æ¦‚ç‡ pkï¼Œä» n=k å¼€å§‹ï¼š  
> å½“ n = k æ—¶ï¼Œæ¦‚ç‡æ˜¯ 1/kï¼›  
> å½“ n = k+1 æ—¶ï¼Œæ¦‚ç‡æ˜¯ 1/k Ã— (k/k+1)ï¼›  
> å½“ n = k+2 æ—¶ï¼Œæ¦‚ç‡æ˜¯ 1/k Ã— k/(k+1) Ã— (k+1)/(k+2)ï¼›  
> ...  
> å‡è®¾é“¾è¡¨é•¿åº¦ä¸ºLï¼Œn = L æ—¶æ¦‚ç‡æ˜¯ pk = 1/k Ã— k/(k+1) Ã— (k+1)/(k+2) Ã— ... Ã— (L-1)/L = 1/L  

----
**é—®é¢˜2ï¼š**æœ‰ä¸€ä¸ªé•¿åº¦æœªçŸ¥ä½†æœ‰é™çš„é“¾è¡¨K={k1, k2, k3...}ï¼Œç°åœ¨éœ€è¦ä»é“¾è¡¨ä¸­é€‰å–ä¸€ä¸ªå…ƒç´ ï¼Œä½¿å¾— K ä¸­æ¯ä¸€ä¸ªå…ƒç´ è¢«é€‰ä¸­çš„æ¦‚ç‡æƒé‡ä¸ºW={w1, w2, w3...}ã€‚**æ—¶é—´å¤æ‚åº¦ä¾ç„¶æ˜¯O(n)ã€‚**  
**è§£å†³2ï¼š**ä»å‰åˆ°åéå†é“¾è¡¨ã€‚è®¾å½“å‰å…ƒç´ ä¸º knï¼Œåˆ™ä»[0,1) ä¸­éšæœºä¸€ä¸ªæµ®ç‚¹å€¼ rï¼Œå¦‚æœ râ‰¥(Î£n-1)/(Î£n) åˆ™ä»¤ kn ä¸ºé€‰ä¸­å€¼ã€‚ç­‰é“¾è¡¨éå†è¿‡ä¸€æ¬¡ä¹‹åï¼Œå°†é€‰ä¸­å€¼è¿”å›ã€‚è¿™é‡Œ Î£n = w1+...+wn  

```python
ret = k.first
crnt_node = k.first
summed_weight = k.first.weight
while crnt_node.next != None:
    old_weight = summed_weight
    summed_weight = summed_weight + crnt_node.weight
    if rand() >= old_weight / summed_weight:
        ret = crnt_node
    crnt_node = crnt_node.next
``` 

> ğŸ’¡è€ƒè™‘ç¬¬ä¸€ä¸ªèŠ‚ç‚¹è¢«é€‰ä¸­çš„æ¦‚ç‡ p1ï¼š  
> å½“ n = 1 æ—¶ï¼Œæ¦‚ç‡æ˜¯ 1ï¼›  
> å½“ n = 2 æ—¶ï¼Œæ¦‚ç‡æ˜¯ w1/(w1+w2)ï¼›  
> å½“ n = 3 æ—¶ï¼Œæ¦‚ç‡æ˜¯åœ¨ n=2 é€‰ä¸­çš„åŸºç¡€ä¸Šä¹˜ä»¥ (w1+w2)/(w1+w2+w3)ï¼Œå› æ­¤æ˜¯ w1/(w1+w2) Ã— (w1+w2)/(w1+w2+w3)=w1/(w1+w2+w3)ï¼›  
> ...  
> å‡è®¾é“¾è¡¨é•¿åº¦ä¸ºLï¼Œn = L æ—¶æ¦‚ç‡æ˜¯ p1 = w1/(w1+w2) Ã— (w1+w2)/(w1+w2+w3) Ã— ... Ã— Î£(L-1)/Î£L = w1/Î£L  
>   
> åŒç†å¯å¾— pk = wk/Î£L.  *Q.E.D.*  
> ç‰¹åˆ«åœ°ï¼Œå½“ Î£L = 1 ï¼Œä¹Ÿå°±æ˜¯ W åˆ—è¡¨çš„æƒé‡å’Œç­‰äº1ï¼Œpk = wk  
----
**é—®é¢˜3ï¼š**æœ‰ä¸€ä¸ªé•¿åº¦æœªçŸ¥ä½†æœ‰é™çš„é“¾è¡¨K={k1, k2, k3...}ï¼Œå¯¹ä»»æ„ n æœ‰f(kn)=Tnï¼ŒTnâˆˆ{t1,t2,...tm}ã€‚ç°åœ¨éœ€è¦ä» K ä¸­é€‰å–ä¸€ä¸ªå…ƒç´  kï¼Œä½¿å¾— f(k) çš„æ¦‚ç‡æƒé‡ä¸ºW={w1, w2, ..., wt}ã€‚f(k)ç›¸ç­‰çš„ç‰©ä½“æ¦‚ç‡ç›¸ç­‰ã€‚    
ä¸¾ä¾‹ï¼šæœ‰è‹¥å¹²å¼ çº¸ç‰Œï¼Œæ¯å¼ çº¸ç‰Œå½’å±äºä¸€ä¸ªç‰¹å®šçš„èŠ±è‰²Tnï¼Œéœ€è¦æŒ‰èŠ±è‰²æƒé‡éšæœºé€‰å–å¡ç‰Œï¼ŒåŒèŠ±è‰²çš„å¡ç‰Œæ¦‚ç‡ç›¸ç­‰ã€‚  
**è§£ç­”3ï¼š**è¿™ç§æƒ…å†µå±äºåˆ†å±‚æ¦‚ç‡ï¼Œæ¯ä¸ªå…ƒç´ æœ‰ä¸¤ç§æƒé‡ï¼šè·¨ç±»åˆ«æƒé‡å’ŒåŒç±»åˆ«çš„æƒé‡ã€‚å¯ä»¥ç»“åˆå‰ä¸¤ç§æƒ…å†µè§£å†³ã€‚**æ—¶é—´å¤æ‚åº¦ä¾ç„¶æ˜¯O(n)ã€‚ç©ºé—´å¤æ‚åº¦æ˜¯O(m)ï¼Œmæ˜¯ç±»åˆ«æ•°ã€‚**  
  
> ä¾ç„¶ä»å‰åˆ°åéå†åˆ—è¡¨ï¼š  
> 1. å½“æ¯ç±»å…ƒç´ ç¬¬ä¸€æ¬¡å‡ºç°æ—¶ï¼Œä½¿ç”¨è§£å†³2çš„æ–¹æ¡ˆï¼Œä»¥ç±»åˆ«æƒé‡å’Œé€‰ä¸­å…ƒç´ å¯¹æ¯”ï¼Œç­‰äºæ˜¯ä»¥æƒé‡å¯¹ç±»åˆ«æŠ½æ ·  
>
> 2. å½“å‰å…ƒç´ ä¸æ˜¯ç¬¬ä¸€æ¬¡å‡ºç°æ—¶ï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼š  
>>   2.1. å½“å‰å…ƒç´ å’Œé€‰ä¸­å…ƒç´ ç±»å‹ä¸€è‡´ï¼Œè¿™æ—¶é‡‡ç”¨è§£å†³1çš„æ–¹æ¡ˆï¼Œåœ¨ç»„å†…é‡‡æ ·ã€‚éœ€è¦è®°å½•æ¯ä¸€ç»„çš„å·²éå†çš„æ•°é‡ã€‚  
>>   2.2. å½“å‰å…ƒç´ å’Œé€‰ä¸­å…ƒç´ ç±»å‹ä¸ä¸€è‡´ï¼Œè¿™æ—¶ä¸åšå¤„ç†ï¼Œé€‰ä¸­å…ƒç´ ä¸å˜ã€‚å› ä¸ºè·¨ç±»å‹çš„æŠ½æ ·åœ¨è¯¥ç±»å‹ç¬¬ä¸€æ¬¡å‡ºç°æ—¶å·²ç»æ‰§è¡Œè¿‡äº†ã€‚  

```python
ret = k.first
crnt_node = k.first
summed_weight = 0
counts_by_type = {}
while crnt_node.next != None:
    crnt_type = crnt_node.type
    counts_by_type[crnt_type] = counts_by_type[crnt_type] + 1 if crnt_type in counts_by_type else 1
    if counts_by_type[crnt_type] == 1:
        # ç±»å‹ç¬¬ä¸€æ¬¡å‡ºç°ï¼Œä»¥æƒé‡æ¯”è¾ƒ
        old_weight = summed_weight
        summed_weight = summed_weight + crnt_node.weight
        if rand() >= old_weight / summed_weight:
            ret = crnt_node
    elif crnt_node.type == ret.type:
        # å’Œå½“å‰ç»“æœidä¸€è‡´ï¼Œæœºä¼šå‡ç­‰
        if rand() < 1 / counts_by_type[crnt_type]:
            ret = crnt_node
    else:
        # ä¸åšå¤„ç†
        pass
    crnt_node = crnt_node.next
```
  
----
**é—®é¢˜3.1ï¼š**æœ‰ä¸€ä¸ªé•¿åº¦æœªçŸ¥ä½†æœ‰é™çš„é“¾è¡¨K={k1, k2, k3...}ï¼Œå¯¹ä»»æ„ n æœ‰f(kn)=Tnï¼ŒTnâˆˆ{v1,v2,...vt}ã€‚ç°åœ¨éœ€è¦ä» K ä¸­é€‰å–ä¸€ä¸ªå…ƒç´  kï¼Œä½¿å¾— f(k) çš„æ¦‚ç‡æƒé‡ä¸ºW={w1, w2, ..., wt}ã€‚f(k)ç›¸ç­‰çš„ç‰©ä½“æŒ‰ç…§ç¬¬äºŒå±‚æ¦‚ç‡é‡‡æ ·ã€‚  
**è§£ç­”3.1ï¼š**è¿™ç§æƒ…å†µåŒæ ·å±äºåˆ†å±‚æ¦‚ç‡ï¼ŒåŒºåˆ«åœ¨äºç¬¬äºŒå±‚ä¾ç„¶æ˜¯æŒ‰æƒé‡åˆ†é…æ¦‚ç‡ã€‚å¯ä»¥å‚è€ƒè§£ç­”3è§£å†³ã€‚